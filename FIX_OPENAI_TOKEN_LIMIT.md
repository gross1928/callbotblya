# Исправление проблемы с лимитом токенов OpenAI

## Проблема
OpenAI API возвращал пустой `content` с `finish_reason: "length"`, что означало, что модель `gpt-5-nano` исчерпала лимит токенов (3000). Модель использовала все токены на reasoning (размышления), но не успевала вернуть финальный результат.

## Симптомы
```
[analyzeFoodFromText] Empty or no content in response
"content": "",
"finish_reason": "length",
"completion_tokens": 3000,
"reasoning_tokens": 3000
```

## Решение
Увеличены лимиты токенов и добавлена проверка на обрезание ответа:

### 1. Увеличены `max_completion_tokens` во всех функциях:
- `analyzeFoodFromText`: 3000 → **6000**
- `analyzeFoodFromPhoto`: 3000 → **6000**
- `analyzeMedicalPhoto`: 3000 → **6000**
- `analyzeMedicalData`: 2000 → **6000**
- `getAICoachResponse`: 8000 (без изменений - уже было достаточно)

### 2. Добавлена проверка на `finish_reason === 'length'`:
Теперь, если модель исчерпает лимит токенов, пользователь получит понятное сообщение:
- "Ответ модели был обрезан. Попробуй описать блюдо проще или короче."
- "Ответ модели был обрезан. Попробуй другое фото или опиши блюдо текстом."
- и т.д.

### 3. Добавлено логирование:
- `console.log('[функция] Finish reason:', ...)` - причина завершения
- `console.log('[функция] Usage:', ...)` - использование токенов

## Что дальше?
После деплоя изменений:
1. Протестируй анализ еды по текстовому описанию
2. Проверь анализ фото еды
3. Проверь медицинские функции

Теперь модель `gpt-5-nano` будет иметь достаточно токенов для:
- Reasoning (обдумывания) - до ~3000-4000 токенов
- Финального ответа - оставшиеся ~2000-3000 токенов

## Стоимость
Увеличение лимита с 3000 до 6000 токенов удвоит стоимость запросов, но модель `gpt-5-nano` всё ещё остаётся очень дешёвой:
- Input: $0.05/1M токенов
- Output: $0.40/1M токенов

Для сравнения, один запрос с 6000 токенами будет стоить ~$0.0024 (меньше четверти цента).


