# üõ°Ô∏è Rate Limiting - –ó–∞—â–∏—Ç–∞ –æ—Ç –ê—Ç–∞–∫ –∏ –í—ã—Å–æ–∫–∏—Ö –°—á–µ—Ç–æ–≤

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–∏—Å—Ç–µ–º–∞ Rate Limiting –∑–∞—â–∏—â–∞–µ—Ç –±–æ—Ç–∞ –æ—Ç:
- üí∏ **–û–≥—Ä–æ–º–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ OpenAI** (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)
- ü§ñ **DoS –∞—Ç–∞–∫** (Denial of Service)
- üî• **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- üòà **–ó–ª–æ–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

---

## üìä –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –õ–∏–º–∏—Ç—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (OpenAI –∑–∞–ø—Ä–æ—Å—ã - –î–û–†–û–ì–û!)

| –î–µ–π—Å—Ç–≤–∏–µ | –õ–∏–º–∏—Ç | –ü–µ—Ä–∏–æ–¥ | –°—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –∑–∞—â–∏—Ç—ã |
|----------|-------|--------|---------------------|
| **–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –µ–¥—ã** | 10 —Ñ–æ—Ç–æ | 1 —á–∞—Å | $20/—á–∞—Å √ó 24 = $480/–¥–µ–Ω—å |
| **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –µ–¥—ã** | 20 –∑–∞–ø—Ä–æ—Å–æ–≤ | 1 —á–∞—Å | $10/—á–∞—Å √ó 24 = $240/–¥–µ–Ω—å |
| **AI-–∫–æ—É—á** | 30 —Å–æ–æ–±—â–µ–Ω–∏–π | 1 —á–∞—Å | $15/—á–∞—Å √ó 24 = $360/–¥–µ–Ω—å |
| **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã** | 5 –∞–Ω–∞–ª–∏–∑–æ–≤ | 1 –¥–µ–Ω—å | $5/–¥–µ–Ω—å √ó 30 = $150/–º–µ—Å |

### üü° –û–±—ã—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

| –î–µ–π—Å—Ç–≤–∏–µ | –õ–∏–º–∏—Ç | –ü–µ—Ä–∏–æ–¥ |
|----------|-------|--------|
| **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—ã** | 50 —Ä–∞–∑ | 1 —á–∞—Å |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞** | 100 —Ä–∞–∑ | 1 —á–∞—Å |

### üåê –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç

| –õ–∏–º–∏—Ç | –ü–µ—Ä–∏–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|-----------|
| **200 –¥–µ–π—Å—Ç–≤–∏–π** | 1 —á–∞—Å | –ó–∞—â–∏—Ç–∞ –æ—Ç DoS –∞—Ç–∞–∫ |

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏—è

### –ë–µ–∑ Rate Limiting (–∞—Ç–∞–∫–∞):
```
1 –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫:
- 1000 —Ñ–æ—Ç–æ/—á–∞—Å √ó $0.02 = $20/—á–∞—Å
- 24 —á–∞—Å–∞ √ó $20 = $480/–¥–µ–Ω—å
- 30 –¥–Ω–µ–π √ó $480 = $14,400/–º–µ—Å—è—Ü

10 –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ = $144,000/–º–µ—Å—è—Ü! üò±üí∏
```

### –° Rate Limiting:
```
1 –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫:
- –ú–∞–∫—Å–∏–º—É–º 10 —Ñ–æ—Ç–æ/—á–∞—Å √ó $0.02 = $0.20/—á–∞—Å
- 24 —á–∞—Å–∞ √ó $0.20 = $4.80/–¥–µ–Ω—å
- 30 –¥–Ω–µ–π √ó $4.80 = $144/–º–µ—Å—è—Ü

10 –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ = $1,440/–º–µ—Å—è—Ü ‚úÖ

–≠–∫–æ–Ω–æ–º–∏—è: $142,560/–º–µ—Å—è—Ü! üéâ
```

---

## üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –û–ø—ã—Ç

### –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞:

**–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ:**
```
‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ.

–ú–∞–∫—Å–∏–º—É–º: 10 —Ñ–æ—Ç–æ –≤ —á–∞—Å.

–ü–æ–ø—Ä–æ–±—É–π —á–µ—Ä–µ–∑ 45 –º–∏–Ω—É—Ç.
```

**AI-–∫–æ—É—á:**
```
‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π AI-–∫–æ—É—á—É.

–ú–∞–∫—Å–∏–º—É–º: 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å.

–ü–æ–ø—Ä–æ–±—É–π —á–µ—Ä–µ–∑ 23 –º–∏–Ω—É—Ç—ã.
```

**–ì–ª–æ–±–∞–ª—å–Ω—ã–π:**
```
‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –æ–±—â–∏–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É.

–ú–∞–∫—Å–∏–º—É–º: 200 –¥–µ–π—Å—Ç–≤–∏–π –≤ —á–∞—Å.

–ü–æ–ø—Ä–æ–±—É–π —á–µ—Ä–µ–∑ 1 —á–∞—Å.
```

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
```typescript
// –ü—Ä–∏–º–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ
const limit = checkRateLimit(userId, 'FOOD_PHOTO_ANALYSIS');

if (!limit.allowed) {
  await ctx.reply(limit.message);
  return; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å!
}

// –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...
```

### 2. –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (Map)
```typescript
// –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–µ–π—Å—Ç–≤–∏—è:
{
  userId: 12345,
  action: 'FOOD_PHOTO_ANALYSIS',
  count: 7,           // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
  resetAt: 1696512000 // –∫–æ–≥–¥–∞ —Å–±—Ä–æ—Å–∏—Ç—Å—è
}
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
```
–ö–∞–∂–¥—ã–π —á–∞—Å —É–¥–∞–ª—è—é—Ç—Å—è –∏—Å—Ç–µ–∫—à–∏–µ –∑–∞–ø–∏—Å–∏
‚Üí –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```
–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:
[Rate Limiter] Stats: {
  totalUsers: 150,
  totalLimits: 234,
  activeUsers: 89,
  memoryUsage: "23.4 KB"
}
```

---

## üìç –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

### ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ:

1. **Middleware (–≥–ª–æ–±–∞–ª—å–Ω–æ)** - –ø–µ—Ä–≤–∞—è –ª–∏–Ω–∏—è –∑–∞—â–∏—Ç—ã
   - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å–ø–∞–º
   - 200 –¥–µ–π—Å—Ç–≤–∏–π/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –µ–¥—ã** - —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ!
   - 10 —Ñ–æ—Ç–æ/—á–∞—Å
   - Vision API —Å—Ç–æ–∏—Ç $0.01-0.02/—Ñ–æ—Ç–æ

3. **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –µ–¥—ã**
   - 20 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
   - GPT-4 —Å—Ç–æ–∏—Ç $0.005/–∑–∞–ø—Ä–æ—Å

4. **AI-–∫–æ—É—á**
   - 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å
   - –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

5. **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã**
   - 5 –∞–Ω–∞–ª–∏–∑–æ–≤/–¥–µ–Ω—å
   - –û—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ–π Vision API

6. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–¥—ã**
   - 50 —Ä–∞–∑/—á–∞—Å
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –≤ –ë–î

7. **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—à–±–æ—Ä–¥–∞**
   - 100 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤/—á–∞—Å
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ë–î

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤ Railway Dashboard

**–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞:**
```
[Rate Limiter] Starting periodic cleanup...
```

**–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤:**
```
[Rate Limiter] Stats: {
  totalUsers: 150,
  totalLimits: 234,
  activeUsers: 89,
  memoryUsage: "23.4 KB"
}
[Rate Limiter] Top users by request count: [
  { userId: 12345, requests: 89 },
  { userId: 67890, requests: 67 },
  ...
]
```

**–ü—Ä–∏ cleanup:**
```
[Rate Limiter] Cleaned up 47 expired entries
```

**–ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
- –í –ª–æ–≥–∞—Ö –Ω–∏—á–µ–≥–æ –Ω–µ –ø–∏—à–µ—Ç—Å—è (—ç—Ç–æ –Ω–æ—Ä–º–∞)

---

## üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –õ–∏–º–∏—Ç–æ–≤

–í—Å–µ –ª–∏–º–∏—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `src/utils/rate-limiter.ts`:

```typescript
export const RATE_LIMITS = {
  FOOD_PHOTO_ANALYSIS: {
    maxRequests: 10,           // ‚Üê –∏–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å
    windowMs: 60 * 60 * 1000,  // ‚Üê –∏–ª–∏ –∑–¥–µ—Å—å
    message: '–¢–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
  },
  // ...
};
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é:

**–ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ:**
```typescript
// –ë—ã–ª–æ: 10 —Ñ–æ—Ç–æ/—á–∞—Å
maxRequests: 15, // –°—Ç–∞–ª–æ: 15 —Ñ–æ—Ç–æ/—á–∞—Å
```

**–ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –ª–∏–±–µ—Ä–∞–ª—å–Ω–æ:**
```typescript
// –ë—ã–ª–æ: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å
maxRequests: 20, // –°—Ç–∞–ª–æ: 20 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å
```

**–ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥:**
```typescript
// –ë—ã–ª–æ: 1 —á–∞—Å
windowMs: 30 * 60 * 1000, // –°—Ç–∞–ª–æ: 30 –º–∏–Ω—É—Ç
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ñ–æ—Ç–æ
1. –û—Ç–ø—Ä–∞–≤—å –±–æ—Ç—É 11 —Ñ–æ—Ç–æ –ø–æ–¥—Ä—è–¥ (–±—ã—Å—Ç—Ä–æ)
2. –ü–æ—Å–ª–µ 10-–≥–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç"
3. –ü–æ–¥–æ–∂–¥–∏ 1 —á–∞—Å - –ª–∏–º–∏—Ç —Å–±—Ä–æ—Å–∏—Ç—Å—è

### –¢–µ—Å—Ç 2: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç
1. –ë—ã—Å—Ç—Ä–æ –æ—Ç–ø—Ä–∞–≤—å 201 –ª—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
2. –ü–æ—Å–ª–µ 200-–≥–æ: "‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –æ–±—â–∏–π –ª–∏–º–∏—Ç"

### –¢–µ—Å—Ç 3: AI-–∫–æ—É—á
1. –û—Ç–ø—Ä–∞–≤—å 31 —Å–æ–æ–±—â–µ–Ω–∏–µ AI-–∫–æ—É—á—É
2. –ü–æ—Å–ª–µ 30-–≥–æ: "‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π"

### –¢–µ—Å—Ç 4: –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞
1. –ü—Ä–µ–≤—ã—Å–∏ –ª–∏–º–∏—Ç
2. –ü–æ–¥–æ–∂–¥–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
3. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

---

## üîß –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏

### –°–±—Ä–æ—Å–∏—Ç—å –ª–∏–º–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
import { resetRateLimit, resetAllLimitsForUser } from './utils/rate-limiter';

// –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ª–∏–º–∏—Ç
resetRateLimit(12345, 'FOOD_PHOTO_ANALYSIS');

// –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –ª–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
resetAllLimitsForUser(12345);
```

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```typescript
import { getRateLimitStats, getRateLimiterStats } from './utils/rate-limiter';

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
const stats = getRateLimitStats(12345, 'FOOD_PHOTO_ANALYSIS');
console.log(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${stats.used}/${stats.limit}`);

// –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
const globalStats = getRateLimiterStats();
console.log(`–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${globalStats.activeUsers}`);
```

---

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. In-Memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ **–ü–ª—é—Å—ã:** –ë—ã—Å—Ç—Ä–æ, –ø—Ä–æ—Å—Ç–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚ö†Ô∏è **–ú–∏–Ω—É—Å—ã:** –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
- üîÑ **–†–µ—à–µ–Ω–∏–µ:** –î–ª—è production —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏ –Ω—É–∂–µ–Ω Redis

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```
–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è
‚Üì
–í—Å–µ –ª–∏–º–∏—Ç—ã —Å–±—Ä–æ—Å–∏–ª–∏—Å—å
‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–Ω–æ–≤–∞ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
```
**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç.–∫. –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ —Ä–µ–¥–∫–∏

### 3. –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –õ–∏–º–∏—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –ü—Ä–∏ –∫—Ä–∞—à–µ –≤—Å–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ:** –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Redis/–ë–î

---

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –±–æ—Ç–∞:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Redis (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
npm install ioredis rate-limiter-flexible
```

```typescript
import Redis from 'ioredis';
import { RateLimiterRedis } from 'rate-limiter-flexible';

const redis = new Redis(process.env.REDIS_URL);

const limiter = new RateLimiterRedis({
  storeClient: redis,
  points: 10,
  duration: 3600,
});
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** $5-15/–º–µ—Å—è—Ü (Upstash, Redis Labs)

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–•—Ä–∞–Ω–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –≤ Supabase (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)

---

## üí° –°–æ–≤–µ—Ç—ã

### 1. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏
```bash
# –í Railway Dashboard ‚Üí Logs
# –ò—â–∏—Ç–µ: [Rate Limiter]
```

### 2. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ª–∏–º–∏—Ç—ã
- –°–º–æ—Ç—Ä–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ï—Å–ª–∏ —á–µ—Å—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è - —É–≤–µ–ª–∏—á—å
- –ï—Å–ª–∏ —Å—á–µ—Ç OpenAI —Ä–∞—Å—Ç–µ—Ç - —É–º–µ–Ω—å—à–∏

### 3. –£–≤–µ–¥–æ–º–ª—è–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–º–∏ ("10 —Ñ–æ—Ç–æ –≤ —á–∞—Å")
- ‚úÖ –° –≤—Ä–µ–º–µ–Ω–µ–º –æ–∂–∏–¥–∞–Ω–∏—è ("—á–µ—Ä–µ–∑ 23 –º–∏–Ω—É—Ç—ã")
- ‚úÖ –î—Ä—É–∂–µ–ª—é–±–Ω—ã–º–∏ (–Ω–µ "ERROR 429")

### 4. –û—Å–æ–±—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
```typescript
// –ê–¥–º–∏–Ω—ã –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤
if (isAdmin(userId)) {
  return { allowed: true };
}
```

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ Rate Limiting:
- ‚ùå –†–∏—Å–∫ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –æ—Ç —Å—á–µ—Ç–æ–≤ OpenAI
- ‚ùå –£—è–∑–≤–∏–º–æ—Å—Ç—å –∫ DoS –∞—Ç–∞–∫–∞–º
- ‚ùå –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –°—Ç—Ä–µ—Å—Å üò∞

### –ü–æ—Å–ª–µ Rate Limiting:
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å—Ö–æ–¥–æ–≤
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- ‚úÖ –°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ üòå

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–æ–ø—Ä–æ—Å—ã?**
- Telegram: @grossvn
- –í—Å–µ –ª–∏–º–∏—Ç—ã –≤ `src/utils/rate-limiter.ts`
- –õ–æ–≥–∏ –≤ Railway Dashboard

**–£–¥–∞—á–∏! –¢–µ–ø–µ—Ä—å —Ç–≤–æ–π –±–æ—Ç –∑–∞—â–∏—â–µ–Ω! üõ°Ô∏è**
